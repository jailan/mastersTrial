<!DOCTYPE html>
<html>

<head>
      <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Super Hawaz</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="css/fontello.css" />
    <link rel="stylesheet" href="css/hawaz.css" />
    <link href="/assets/fire/fireworks.css" rel="stylesheet">

    <%= content_tag :div, class: "temp_information", data: {temp: @temppuzzle} do %>
<% end %>
<style>
body{
background-color: #333;
background-image: url("/assets/rsz_background2.png");
background-size: cover;

    } 
        .button {
        display: inline-block;
        outline: none;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        font: 14px/100% Arial, Helvetica, sans-serif;
        padding: .5em 2em .55em;
        text-shadow: 0 1px 1px rgba(0,0,0,.3);
        -webkit-border-radius: .5em; 
        -moz-border-radius: .5em;
        border-radius: .5em;
        -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.2);
        -moz-box-shadow: 0 1px 2px rgba(0,0,0,.2);
        box-shadow: 0 1px 2px rgba(0,0,0,.2);
        float:right;
        margin-right: 20px;
        width:90px;



    }
    .orange {
        color: #fef4e9;
        border: solid 1px #da7c0c;
        background: #f78d1d;
        background: -webkit-gradient(linear, left top, left bottom, from(#faa51a), to(#f47a20));
        background: -moz-linear-gradient(top,  #faa51a,  #f47a20);
        filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#faa51a', endColorstr='#f47a20');
        border-radius : 100%;
    }
    .orange:hover {
        background: #f47c20;
        background: -webkit-gradient(linear, left top, left bottom, from(#f88e11), to(#f06015));
        background: -moz-linear-gradient(top,  #f88e11,  #f06015);
        filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#f88e11', endColorstr='#f06015');
    }
    .orange:active {
        color: #fcd3a5;
        background: -webkit-gradient(linear, left top, left bottom, from(#f47a20), to(#faa51a));
        background: -moz-linear-gradient(top,  #f47a20,  #faa51a);
        filter:  progid:DXImageTransform.Microsoft.gradient(startColorstr='#f47a20', endColorstr='#faa51a');
    }


    .button:hover {
        text-decoration: none;
    }
    .button:active {
        position: relative;
        top: 1px;
    }

    .btnBlue {
  background: #3baaf5;
  background-image: -webkit-linear-gradient(top, #3baaf5, #1021de);
  background-image: -moz-linear-gradient(top, #3baaf5, #1021de);
  background-image: -ms-linear-gradient(top, #3baaf5, #1021de);
  background-image: -o-linear-gradient(top, #3baaf5, #1021de);
  background-image: linear-gradient(to bottom, #3baaf5, #1021de);
  -webkit-border-radius: 11;
  -moz-border-radius: 11;
  border-radius: 11px;
  font-family: Arial;
  color: #ffffff;
  font-size: 13px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.btnBlue:hover {
  background: #0a1bcc;
  background-image: -webkit-linear-gradient(top, #0a1bcc, #042985);
  background-image: -moz-linear-gradient(top, #0a1bcc, #042985);
  background-image: -ms-linear-gradient(top, #0a1bcc, #042985);
  background-image: -o-linear-gradient(top, #0a1bcc, #042985);
  background-image: linear-gradient(to bottom, #0a1bcc, #042985);
  text-decoration: none;
}
.btnGreen {
  background: #5cb524;
  background-image: -webkit-linear-gradient(top, #5cb524, #255705);
  background-image: -moz-linear-gradient(top, #5cb524, #255705);
  background-image: -ms-linear-gradient(top, #5cb524, #255705);
  background-image: -o-linear-gradient(top, #5cb524, #255705);
  background-image: linear-gradient(to bottom, #5cb524, #255705);
  -webkit-border-radius: 11;
  -moz-border-radius: 11;
  border-radius: 11px;
  font-family: Arial;
  color: #ffffff;
  font-size: 13px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.btnGreen:hover {
  background: #0acc11;
  background-image: -webkit-linear-gradient(top, #0acc11, #257a1d);
  background-image: -moz-linear-gradient(top, #0acc11, #257a1d);
  background-image: -ms-linear-gradient(top, #0acc11, #257a1d);
  background-image: -o-linear-gradient(top, #0acc11, #257a1d);
  background-image: linear-gradient(to bottom, #0acc11, #257a1d);
  text-decoration: none;
}
.btnYellow {
  background: #ffff00;
  background-image: -webkit-linear-gradient(top, #ffff00, #ffd500);
  background-image: -moz-linear-gradient(top, #ffff00, #ffd500);
  background-image: -ms-linear-gradient(top, #ffff00, #ffd500);
  background-image: -o-linear-gradient(top, #ffff00, #ffd500);
  background-image: linear-gradient(to bottom, #ffff00, #ffd500);
  -webkit-border-radius: 11;
  -moz-border-radius: 11;
  border-radius: 11px;
  font-family: Arial;
  color: #ffffff;
  font-size: 13px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.btnYellow:hover {
  background: #ffff00;
  background-image: -webkit-linear-gradient(top, #ffff00, #f5b105);
  background-image: -moz-linear-gradient(top, #ffff00, #f5b105);
  background-image: -ms-linear-gradient(top, #ffff00, #f5b105);
  background-image: -o-linear-gradient(top, #ffff00, #f5b105);
  background-image: linear-gradient(to bottom, #ffff00, #f5b105);
  text-decoration: none;
}
.btnOrange{

  background: #ff7700;
  background-image: -webkit-linear-gradient(top, #ff7700, #ff9b05);
  background-image: -moz-linear-gradient(top, #ff7700, #ff9b05);
  background-image: -ms-linear-gradient(top, #ff7700, #ff9b05);
  background-image: -o-linear-gradient(top, #ff7700, #ff9b05);
  background-image: linear-gradient(to bottom, #ff7700, #ff9b05);
  -webkit-border-radius: 11;
  -moz-border-radius: 11;
  border-radius: 11px;
  font-family: Arial;
  color: #ffffff;
  font-size: 13px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.btnOrange:hover {
  background: #fa8d3a;
  background-image: -webkit-linear-gradient(top, #fa8d3a, #ffb12b);
  background-image: -moz-linear-gradient(top, #fa8d3a, #ffb12b);
  background-image: -ms-linear-gradient(top, #fa8d3a, #ffb12b);
  background-image: -o-linear-gradient(top, #fa8d3a, #ffb12b);
  background-image: linear-gradient(to bottom, #fa8d3a, #ffb12b);
  text-decoration: none;
}
.btnRed {
  background: #ff000d;
  background-image: -webkit-linear-gradient(top, #ff000d, #8c1414);
  background-image: -moz-linear-gradient(top, #ff000d, #8c1414);
  background-image: -ms-linear-gradient(top, #ff000d, #8c1414);
  background-image: -o-linear-gradient(top, #ff000d, #8c1414);
  background-image: linear-gradient(to bottom, #ff000d, #8c1414);
  -webkit-border-radius: 11;
  -moz-border-radius: 11;
  border-radius: 11px;
  font-family: Arial;
  color: #ffffff;
  font-size: 13px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.btnRed:hover {
  background: #c70000;
  background-image: -webkit-linear-gradient(top, #c70000, #ff4929);
  background-image: -moz-linear-gradient(top, #c70000, #ff4929);
  background-image: -ms-linear-gradient(top, #c70000, #ff4929);
  background-image: -o-linear-gradient(top, #c70000, #ff4929);
  background-image: linear-gradient(to bottom, #c70000, #ff4929);
  text-decoration: none;
}
#level1,#level2,#level3, #level4, #level5{
  top: 500px; position:relative;
  left: 445px;
}
.footer{
  top: 600px;
  position: relative;
}

.round-button {
  width:25%;
}
.round-button-circle {
  width: 100%;
  height:0;
  padding-bottom: 100%;
    border-radius: 50%;
  border:10px solid #cfdcec;
    overflow:hidden;
    
    background: #4679BD; 
    box-shadow: 0 0 3px gray;
}
.round-button-circle:hover {
  background:#30588e;
}
.round-button a {
    display:block;
  float:left;
  width:100%;
  padding-top:50%;
    padding-bottom:50%;
  line-height:1em;
  margin-top:-0.5em;
    
  text-align:center;
  color:#e2eaf3;
    font-family:Verdana;
    font-size:1.2em;
    font-weight:bold;
    text-decoration:none;
}
#peekz{

position: relative;
float:right;
    bottom: 20px;
margin-right: 300px;
    font-size: 5.5em;
    cursor: pointer;
    /* color:#00a*/
   
    display: block;

}




  @media screen and (max-width:1024px) { 
     body {background-image: url('/assets/background2.png');
  background-size: cover;}
  #peekz{

position: relative;
float:right;
    bottom: 20px;
margin-right: 100px;
    font-size: 5.5em;
    cursor: pointer;
    /* color:#00a*/
   
    display: block;

}
  }

</style>

  <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/what-input.min.js"></script>
    <script src="js/foundation.min.js"></script>
    <script src="js/app.js"></script>
      <script src="/assets/fire/requestanimframe.js"></script>
  <script src="/assets/fire/fireworks.js"></script>
    <script type="text/javascript">
        var game = null;
        var imageID;
        var totalRows = 3;
        var totalColumns = 3;
        var imagePrevID = "imgprev";
        var puzzleLevel;
        var puzzleSubLevel;
        var xPos=0;
        var yPos=0;
        var jo = 0 ; 
        var scoreBar = 0;
        var barPercentage =0;
        var lettoz=0;
       

//         document.ontouchmove = function(event){
//     event.preventDefault();
// }
 //             $(document).on('touchend',function(e) {
 //            xPos = e.originalEvent.touches[0].pageX;
 //            yPos = e.originalEvent.touches[0].pageY;
 //             //alert(xPos+" ... "+yPos);
 // });

 //         $(document).on('mouseup',function(e) {
 //            xPos = e.pageX;
 //            yPos = e.pageY;
 //             //alert(xPos+" ... "+yPos);
 // });





        function InitGame(level, sublevel) {
          changeImage();
          puzzleLevel = level;
          puzzleSubLevel = sublevel;
          setTimeout(function(){ LoadNewImage(imageID); }, 1000);
          setTimeout(function(){ changeImage(); }, 1000);
         // LoadNewImage(imageID);

        
          initTouch();
        //showPreview();
           
        }

 function changeImage() {
puzzleletter =2;
puzzleletter = $('.temp_information').data('temp'); 

var image1 = document.getElementById('img1');
var image2 = document.getElementById('img2');
var image3 = document.getElementById('img3');
//image1.src= "/assets/puzzle/arrow2.png";

   // image1.src= "/assets/puzzle/l"+puzzleletter+"/1d.jpg" ;
   // image2.src= "/assets/puzzle/l"+puzzleletter+"/2d.jpg" ;
   // image3.src= "/assets/puzzle/l"+puzzleletter+"/3d.jpg" ;


//    
//puzzleletter =2;
 lettoz = puzzleletter;
//document.getElementById("img1").src= "/assets/puzzle/arrow2.png";
    if(puzzleLevel < 3){

   image1.src= "/assets/puzzle/l"+puzzleletter+"/1.jpg" ;
   image2.src= "/assets/puzzle/l"+puzzleletter+"/2.jpg" ;
   image3.src= "/assets/puzzle/l"+puzzleletter+"/3.jpg" ;
   document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ;
}

if (puzzleLevel === 3 || puzzleLevel === 5){

   image1.src= "/assets/puzzle/l"+puzzleletter+"/1p.jpg" ;
   image2.src= "/assets/puzzle/l"+puzzleletter+"/2p.jpg" ;
   image3.src= "/assets/puzzle/l"+puzzleletter+"/3p.jpg" ;
   document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ; 
}

if (puzzleLevel === 4){

   image1.src= "/assets/puzzle/l"+puzzleletter+"/1d.jpg" ;
   image2.src= "/assets/puzzle/l"+puzzleletter+"/2d.jpg" ;
   image3.src= "/assets/puzzle/l"+puzzleletter+"/3d.jpg" ;
   document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ;
}



}


function hoppa() {
    var co = document.getElementById("canJigsaw");
    var ctxo = co.getContext("2d");
    var imgxo = document.getElementById("img3");
    ctxo.drawImage(imgxo, 20, 20,100,100);
}

function LoadNewImage(imgID) {
            imageID = imgID;
            SetRowsColumn();
            LoadGame();
        }

function LoadNewImage2(imgID) {
           imageID = imgID;
           SetRowsColumn();
           LoadGame();                       
        }


function yourFunction(){
    
  $(document).on('touchend',function(e) {
            xPos=e.originalEvent.changedTouches[0].pageX;
            yPos=e.originalEvent.changedTouches[0].pageY;

            
 });

    setTimeout(yourFunction, 1000);
}


        
function LoadGame() {   
            var canvasID = "canJigsaw";
            game = new jigsaw(canvasID, imageID, totalRows, totalColumns);
            game.initDrawing();
            yourFunction();
            //game.showPreview();

}



function ShowPreview() {
            if (game) {

                game.showPreview();

            }
        }

function SetRowsColumn() {
            totalRows = 2;
            totalColumns = 2;
        }

var puzzleletter = $('.temp_information').data('temp'); 



function imageBlock(no, x, y) {

    this.no = no;
    this.x = x;
    this.y = y;
    this.isSelected = false;
}
var touchLousy =0;
var touch;
function touchHandler(event) {
     touch = event.originalEvent.changedTouches[0];
    var simulatedEvent = document.createEvent("MouseEvent");
        simulatedEvent.initMouseEvent({
        touchstart: "mousedown",
        touchmove: "mousemove",
        touchend: "mouseup",
        touchcancel: "mouseout"
    }[event.type], true, true, window, 1,
        touch.screenX, touch.screenY,
        touch.clientX, touch.clientY, false,
        false, false, false, 0, null);

    touch.target.dispatchEvent(simulatedEvent);
    event.preventDefault();
}

function initTouch() {
    document.addEventListener("touchstart", touchHandler, true);
    document.addEventListener("touchmove", touchHandler, true);
    document.addEventListener("touchend", touchHandler, true);
    document.addEventListener("touchcancel", touchHandler, true);


}

function listen(word){
      textq=word;
     //getSpeech(textq);
    /* speak(textq);*/

     var testAudio = word;
       // alert(dragletter);
    new Audio('/assets/Audio/l'+puzzleletter+'/'+testAudio+'.mp3').play();
}
function speak(word){
var msg = new SpeechSynthesisUtterance();
msg.volume = 1; // 0 to 1
msg.rate = 1; // 0.1 to 10
msg.pitch = 1; //0 to 2
msg.text = word;
msg.lang = 'ar';

msg.onend = function(e) {
  console.log('Finished in ' + event.elapsedTime + ' seconds.');
};

speechSynthesis.speak(msg);
}


function jigsaw(canvasID, imageID, rows,columns) {


    //handlng the major image
if(puzzleLevel ===1 )
           { document.getElementById("img0").src= "/assets/puzzle/l"+puzzleletter+"/letterba2.jpg" ;}

if(puzzleLevel > 1 && puzzleLevel < 5){
         document.getElementById("img0").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"w.jpg" ;

}

if(puzzleLevel ===5){
 document.getElementById("img0").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"d.jpg" ;
   document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"d.jpg" ;}

   
//handling the three puzzle
//puzzleletter =2;

//document.getElementById("img1").src= "/assets/puzzle/arrow2.png";
//     if(puzzleLevel < 3){

//    document.getElementById("img1").src= "/assets/puzzle/l"+puzzleletter+"/1.jpg" ;
//    document.getElementById("img2").src= "/assets/puzzle/l"+puzzleletter+"/2.jpg" ;
//    document.getElementById("img3").src= "/assets/puzzle/l"+puzzleletter+"/3.jpg" ;
//    document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ;
// }

// if (puzzleLevel === 3 || puzzleLevel === 5){

//    document.getElementById("img1").src= "/assets/puzzle/l"+puzzleletter+"/1p.jpg" ;
//    document.getElementById("img2").src= "/assets/puzzle/l"+puzzleletter+"/2p.jpg" ;
//    document.getElementById("img3").src= "/assets/puzzle/l"+puzzleletter+"/3p.jpg" ;
//    document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ; 
// }

// if (puzzleLevel === 4){

//    document.getElementById("img1").src= "/assets/puzzle/l"+puzzleletter+"/1d.jpg" ;
//    document.getElementById("img2").src= "/assets/puzzle/l"+puzzleletter+"/2d.jpg" ;
//    document.getElementById("img3").src= "/assets/puzzle/l"+puzzleletter+"/3d.jpg" ;
//    document.getElementById("imgprev1").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ;
// }
if(puzzleLevel === 4){
   document.getElementById("balala").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"dopac.png" ;}
 
else{
  if ( puzzleLevel === 3 || puzzleLevel === 5){
 document.getElementById("balala").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"popac.png" ;

  }
    else{
 document.getElementById("balala").src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png" ; }}

   // document.getElementById("imgprev2").src= "/assets/puzzle/l"+puzzleletter+"/2opac.png" ;
   // document.getElementById("imgprev3").src= "/assets/puzzle/l"+puzzleletter+"/3opac.png" ;


    var MAIN_IMG_WIDTH = 600;
    var MAIN_IMG_HEIGHT = 600;


    var BLOCK_IMG_WIDTH = 600/1.3;
    var BLOCK_IMG_HEIGHT = 450/1.3;


    var TOTAL_ROWS = rows;// 4;
    var TOTAL_COLUMNS = columns;  //4;

    var TOTAL_PIECES = TOTAL_ROWS * TOTAL_COLUMNS;

    var IMG_WIDTH = Math.round(MAIN_IMG_WIDTH / TOTAL_COLUMNS);
    var IMG_HEIGHT = Math.round(MAIN_IMG_HEIGHT / TOTAL_ROWS);


    var BLOCK_WIDTH = 0; // Math.round(BLOCK_IMG_WIDTH / TOTAL_COLUMNS);
    var BLOCK_HEIGHT = 0; // Math.round(BLOCK_IMG_HEIGHT / TOTAL_ROWS);



    var image1;
    var canvas;
    var ctx;
    var imagePrev;

    this.canvasID = canvasID;
    this.imageID = imageID;

    this.top = 0;
    this.left = 0;

    this.imageBlockList = new Array();


    this.blockList = new Array();

    this.selectedBlock = null;


    this.mySelf = this;


    this.initDrawing = function () {
        mySelf = this;
        selectedBlock = null;
        canvas = document.getElementById(canvasID);

        ctx = canvas.getContext('2d');
      
        // register events
        //canvas.ondblclick = handleOnMouseDbClick;
        canvas.onmousedown = handleOnMouseDown;
        canvas.onmouseup = handleOnMouseUp;
        canvas.onmouseout = handleOnMouseOut;
        canvas.onmousemove = handleOnMouseMove;

        canvas.ontouchstart = handleOnMouseDown;
        canvas.ontouchend = handleOnMouseUp;
        canvas.ontouchcancel = handleOnMouseOut;
        canvas.ontouchmove = handleOnMouseMove;


    
        image1 = document.getElementById(imageID);
        imagePrev = document.getElementById("imgprev");


        initializeNewGame();
    };
    
    function initializeNewGame() {

        // Set block 
        BLOCK_WIDTH = Math.round(BLOCK_IMG_WIDTH / TOTAL_COLUMNS);
        BLOCK_HEIGHT = Math.round(BLOCK_IMG_HEIGHT / TOTAL_ROWS);
        // Draw image
        SetImageBlock();
        DrawGame();




    }


    this.showPreview = function (n) {

        var x1 = 0;
        var y1 = 0;
        var width = BLOCK_IMG_WIDTH - (x1 * 2);
        var height = BLOCK_IMG_HEIGHT - (y1 * 2)
        ctx.save();
        image1 = document.getElementById(imageID);
        var puzzoImg = new Image(); 
        if (puzzleLevel !=4){
        puzzoImg.src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"opac.png";}
        else{
          puzzoImg.src= "/assets/puzzle/l"+puzzleletter+"/"+puzzleSubLevel+"d.jpg";
        }
     
if ( n === 1) {
     new Audio("/assets/Audio/l"+puzzleletter+"/"+puzzleSubLevel+".mp3").play();}

    var co = document.getElementById("canJigsaw");
    var ctxo = co.getContext("2d");
    var imgxo = document.getElementById("balala");
    ctx.clearRect(0, 0, width+10, height+10);
    drawAllImages();
    ctx.drawImage(imgxo, 0, 0,MAIN_IMG_WIDTH,MAIN_IMG_HEIGHT,0,0, width, height);
          //ctx.drawImage(puzzoImg, 0, 0, MAIN_IMG_WIDTH, MAIN_IMG_HEIGHT, x1, y1, width, height);
    

        //imagePrev = document.getElementById("imgprev").src;
       // ctx.drawImage(imagePrev, 0, 0, MAIN_IMG_WIDTH, MAIN_IMG_HEIGHT, x1, y1, width, height);

        //ctx.drawimage("/assets/puzzle/l"+puzzleletter+"/opac1.png", 0, 0, MAIN_IMG_WIDTH, MAIN_IMG_HEIGHT, x1, y1, width, height);

        // DRAE RECTANGLE

        ctx.fillStyle = '#00f'; // blue
        ctx.strokeStyle = '#f00'; // red
        ctx.lineWidth = 2;
        ctx.strokeRect(x1 - 2, y1 - 2, width + 8, height + 8);
        ctx.restore();


    };

  
    function DrawGame() {

       
        clear(ctx);
        drawLines();
        drawAllImages();
        if (selectedBlock) {
            drawImageBlock(selectedBlock);
        }
        //ShowPreview();
    }
      var notRandomX = 620;
      var notRandomY = 5;

function SetImageBlock() {

        var total = TOTAL_PIECES;
        imageBlockList = new Array();
        blockList = new Array();

        var x1 = BLOCK_IMG_WIDTH -80;
        var x2 = canvas.width - 600;
        var y2 = BLOCK_IMG_HEIGHT;
        for (var i = 0; i < total; i++) {

            var randomX = randomXtoY(x1, x2, 2);
            var randomY = randomXtoY(0, y2, 2);
            if(i===0){
             notRandomX = 620-150;
             notRandomY = 5;  
            }
               if(i===1){
             notRandomX = 925-210;
             notRandomY = 170;  
            }
               if(i===3){
             notRandomX = 620-150;
             notRandomY = 170;  
            }
               if(i===2){
             notRandomX = 925-210;
             notRandomY = 5;  
            }
       
           // var imgBlock = new imageBlock(i, randomX, randomY);
     

          var imgBlock = new imageBlock(i, notRandomX, notRandomY);
          // notRandomY = (notRandomY + 230)%920;

            imageBlockList.push(imgBlock);

            var x = (i % TOTAL_COLUMNS) * BLOCK_WIDTH;
            var y = Math.floor(i / TOTAL_COLUMNS) * BLOCK_HEIGHT;

            var block = new imageBlock(i, x, y);
            blockList.push(block);

        }

    }

    function drawLines() {
       
       //ctx.strokeStyle = "#e9e9e9";
        ctx.strokeStyle = "#000000";
        
        ctx.lineWidth = 1;
        ctx.beginPath();
        
        // draw verticle lines
        for (var i = 0; i <= 2; i++) {
            var x = BLOCK_WIDTH * i;
            ctx.moveTo(x, 0);
            ctx.lineTo(x, 347);
        }

        // draw horizontal lines
        for (var i = 0; i <= 2; i++) {
            var y = BLOCK_HEIGHT * i;
            ctx.moveTo(0, y);
            ctx.lineTo(462, y);
        }


        ctx.closePath();
        ctx.stroke();
    }

    function drawAllImages() {

        for (var i = 0; i < imageBlockList.length; i++) {
            var imgBlock = imageBlockList[i];
            if (imgBlock.isSelected == false) {

                drawImageBlock(imgBlock);
            }
        }
    }

    function drawImageBlock(imgBlock) {
        
        drawFinalImage(imgBlock.no, imgBlock.x, imgBlock.y, BLOCK_WIDTH, BLOCK_HEIGHT);
    }
//var imgpo = document.getElementById('img3');
    function drawFinalImage(index, destX, destY, destWidth, destHeight) {
      
        ctx.save();
       

        var srcX = (index % TOTAL_COLUMNS) * IMG_WIDTH;
        var srcY = Math.floor(index / TOTAL_COLUMNS) * IMG_HEIGHT;
         var imgxo = document.getElementById("img3");
    //ctx.drawImage(imgxo, 20, 20,100,100);
         
        ctx.drawImage(image1, srcX, srcY, IMG_WIDTH, IMG_HEIGHT, destX, destY, destWidth, destHeight);


    //ctx.drawImage(imgpo,10,10);
      
        ctx.restore();
    }

    function drawImage(image) {
    

        ctx.save();
           
        ctx.drawImage(image, 0, 0, BLOCK_WIDTH, BLOCK_WIDTH, 10, 10, BLOCK_WIDTH, BLOCK_WIDTH);

        ctx.restore();
    }

    var interval = null;
    var remove_width;
    var remove_height;
    
    function OnFinished() {

        remove_width = BLOCK_WIDTH;
        remove_height = BLOCK_HEIGHT;
        // Clear Board
        interval = setInterval(function () { mySelf.ClearGame(); }, 100);
    }

    this.ClearGame = function () {
        //   alert("f");
        remove_width -= 30;
        remove_height -= 20;

        if (remove_width > 0 && remove_height > 0) {

            clear(ctx);

            for (var i = 0; i < imageBlockList.length; i++) {
                var imgBlock = imageBlockList[i];

                imgBlock.x += 10;
                imgBlock.y += 10;

                drawFinalImage(imgBlock.no, imgBlock.x, imgBlock.y, remove_width, remove_height);
            }

            // DrawGame();
        } else {

            clearInterval(interval);
           
            // Restart game
            initializeNewGame(); 
          //  alert("Congrats....");

        }
    };

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////// EVENTS
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function handleOnMouseDbClick(e) {

        
        selectedBlock = GetImageBlock(e.pageX, e.pageY);
        //alert("clicked");

    }


    function handleOnMouseOut(e) {


        // remove old selected
        if (selectedBlock != null) {

            imageBlockList[selectedBlock.no].isSelected = false;
            selectedBlock = null;
            DrawGame();

        }

    }

    function handleOnMouseDown(e) {
         //ShowPreview();


        // remove old selected
        if (selectedBlock != null) {

            imageBlockList[selectedBlock.no].isSelected = false;
            //alert("remove old selected");

        }


        selectedBlock = GetImageBlock(imageBlockList, e.pageX , e.pageY);

      


        if (selectedBlock) {
             
            
            imageBlockList[selectedBlock.no].isSelected = true;
           // alert("I have already selected !! ");

      }
 

    }
 var flagsCorrecta = [0,0,0,0];
 var audioElementCorrect = document.createElement('audio');
        //audioElementCorrect.setAttribute('src', '/assets/Audio/applause.mp3');
    function handleOnMouseUp(e) {
  //ShowPreview(2);

         $(document).on('touchend',function(e) {
        
            xPos=e.originalEvent.changedTouches[0].pageX;
            yPos=e.originalEvent.changedTouches[0].pageY;

 });
        
            setTimeout(function(){
              if (selectedBlock.no < 7) {
                //alert(selectedBlock.no);
              if (flagsCorrecta[selectedBlock.no] === 0) {

            var index = selectedBlock.no;
            var block;
            if (xPos >0){
               block = GetImageBlock2(blockList,xPos, yPos);}
                else{
              block = GetImageBlock2(blockList,e.pageX, e.pageY);
                }
               // alert("BLOCK NUMBERRR" + block.x);
        
             var blockOldImage = GetImageBlockOnEqual(imageBlockList, block.x, block.y);
             var seeka = selectedBlock.no;
             var seekax;
             var seekay;
             var hoola =0;


            if (block !== 88) {
             hoola = 1;
                if (blockOldImage === null) {
                    imageBlockList[index].x = block.x;
                    imageBlockList[index].y = block.y;
               
                }
                // if(blockOldImage !== 99){
                //   alert("yammaa");
                // }
            }
            if (block === 88){
               hoola =2;
            
              // alert(selectedBlock.x+"....."+selectedBlock.y);
              //go back to sqaure zero
              if(seeka === 0){
             seekax = 620-150;
             seekay = 5;  
            }
               if(seeka === 1){
            seekax = 925-210;
            seekay = 170;  
            }
               if(seeka === 3){
             seekax = 620-150;
             seekay = 170;  
            }
               if(seeka === 2){
             seekax= 925-210;
             seekay = 5;  
            }
       
            imageBlockList[index].x = seekax;
            imageBlockList[index].y = seekay;
            // DrawGame();
           


            }
           // alert(hoola);

            imageBlockList[index].isSelected = false;
            selectedBlock = null;
            DrawGame();

      for (var m = 0; m < TOTAL_PIECES; m++) {

            var img = imageBlockList[m];
            var block = blockList[m];

            if (
                (img.x == block.x) &&
                (img.y == block.y) &&
                (flagsCorrecta[m] === 0)
                ) {

                flagsCorrecta[m]=1;
               new Audio('/assets/Audio/applause.mp3').play();

        // audioElement.setAttribute('src', '/assets/Audio/applause.mp3');
        // audioElement.play();
              //alert(flagsCorrecta);
               // audioElementCorrect.play(); 
            }

        }
            if (isFinished()) {
                setTimeout(function(){UpdateSubStage();}, 2000);
                setTimeout(function(){LoadNewImage();}, 3000);
                OnFinished();            
            }
          }

          else{
       

            //alert(selectedBlock.no+" E2fesh ... "+flagsCorrecta);
            //   imageBlockList[index].isSelected = false;
            // selectedBlock = null;
            // DrawGame();
          }

        }
        else{
          //alert("welmos7af ma block");
          //selectedBlock = 88;

  
        }

   

             
  
}, 1000);



    }

    function handleOnMouseMove(e) {
 ShowPreview(2);

      if (selectedBlock){
       if (flagsCorrecta[selectedBlock.no] === 0) {

            selectedBlock.x = e.pageX-200 ;
            selectedBlock.y = e.pageY-100;
            DrawGame();
          }
        }

    }

    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////// HELPER METHODS
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////

    function clear(c) {
        c.clearRect(0, 0, canvas.width, canvas.height);
    }

    function randomXtoY(minVal, maxVal, floatVal) {
        var randVal = minVal + (Math.random() * (maxVal - minVal));
        var val = typeof floatVal == 'undefined' ? Math.round(randVal) : randVal.toFixed(floatVal);

        return Math.round(val);
    }


    function GetImageBlock(list, x, y) {

        //for (var i = 0; i < list.length; i++) {
        for (var i = list.length - 1; i >= 0; i--) {
            var imgBlock = list[i];

            var x1 = imgBlock.x;
            var x2 = x1 + BLOCK_WIDTH;

            var y1 = imgBlock.y;
            var y2 = y1 + BLOCK_HEIGHT;

            if (
                (x >= x1 && x <= x2) &&
                (y >= y1 && y <= y2)
            ) {
                //alert("found: " + imgBlock.no);

                var img = new imageBlock(imgBlock.no, imgBlock.x, imgBlock.y);
                //drawImageBlock(img);
                return img;

            }
        }

        return null;
    }


    function GetImageBlock2(list, x, y) {

        //for (var i = 0; i < list.length; i++) {
        for (var i = list.length - 1; i >= 0; i--) {
            var imgBlock = list[i];

            var x1 = imgBlock.x;
            var x2 = x1 + BLOCK_WIDTH;

            var y1 = imgBlock.y;
            var y2 = y1 + BLOCK_HEIGHT;

            if (
                (x >= x1 && x <= x2) &&
                (y >= y1 && y <= y2)
            ) {
                //alert("found: " + imgBlock.no);

                var img = new imageBlock(imgBlock.no, imgBlock.x, imgBlock.y);
                //drawImageBlock(img);
                return img;

            }
        }

        return 88;
    }


    function sendStage(n){
        puzzleLevel=n;
        //changeImage();
    }
        function UpdateSubStage(){
            if (puzzleSubLevel<3 && puzzleLevel>1){
        puzzleSubLevel++;}
    else{
              var audioElement = document.createElement('audio');
        // audioElement.setAttribute('src', '/assets/Audio/finish.mp3');
        // audioElement.play();
       updateLevel();
     

    }
  }

    function updateLevel(){


        if (puzzleLevel<5){
        puzzleLevel++;

       InitGame(puzzleLevel,1);}
    else{
       // new Audio('/assets/Audio/applausy.mp3').play();
    celebrate();

    }
   //changeImage();
    //setTimeout(function(){ InitGame(puzzleLevel,1); }, 4000);
   

    }
       
   // InitGame(puzzleLevel,puzzleSubLevel);
    


        $('#level1').click(function() {
    
     
        InitGame(1,1);
    });

        $('#level2').click(function() {
      
        InitGame(2,1)
    });
        $('#level3').click(function() {
    
        InitGame(3,1);
    });
        $('#level4').click(function() {
    
  
        InitGame(4,1);
    });
        $('#level5').click(function() {
 
        InitGame(5,1);
    });

        $('#img44').click(function() {
 
      //LoadNewImage('img3');
      hoppa();

    });

    function GetImageBlockOnEqual(list, x, y) {


        for (var i = 0; i < list.length; i++) {
            var imgBlock = list[i];

            var x1 = imgBlock.x;
            var y1 = imgBlock.y;

            if (
                (x == x1) &&
                (y == y1)
            ) {

                var img = new imageBlock(imgBlock.no, imgBlock.x, imgBlock.y);
                //drawImageBlock(img);
                return img;

            }
        }

        return null;
    }



    function isFinished() {
    //ShowPreview();
    var total = TOTAL_PIECES;

  for (var i = 0; i < total; i++) {

            var img = imageBlockList[i];
            var block = blockList[i];

            if (
                (img.x != block.x) ||
                (img.y != block.y)
                ) {

                return false;
            }

        }

        var nameofID = "img"+puzzleSubLevel;
       if (nameofID === imageID || puzzleLevel === 1){
               
        scoreBar++;
        if(puzzleSubLevel === 3 ){
          // if(puzzleLevel === 5){
          //   new Audio('/assets/Audio/applausy.mp3').play();

          // }

           new Audio('/assets/Audio/tada.mp3').play();
           new Audio('/assets/Audio/applausy.mp3').play();
        }
        else{
          new Audio('/assets/Audio/applausy.mp3').play();
      
        }
        barPercentage = (scoreBar*100)/15;
        document.getElementById('myBar').style.width = barPercentage+'%';

        return true;}


        else{
          new Audio('/assets/Audio/boing.mp3').play();
          if(stagy>1){
        

          return false;}
        }
        
         
        
    }

}

//$(document).ready(function (){initTouch();});

//var puzzleLevel = $('.temp_information').data('stagy'); 
 //document.getElementById("img1").src= "/assets/puzzle/'l2'/apple.jpg" ;

$(document).bind('touchmove', false);
   var bod=$("body").css("background-color","#333");


    </script>
</head>
 <style>
 canvas{
    position: absolute;
     left: 20px;

 }
 </style>
 <meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<body onload="InitGame(1,1);" style="zoom:100%;">
    <div class="menu-container" style="height: 50px;">
      <div class="row">
        <div class="large-12 columns">
          <ul class="menu align-right">

           <li id="site-title"><a href="home"><h3>Super Hawwaz</h3></a></li>

         </ul>
       </div>
      </div>
    </div>

    <div id="overlay">

      <div class="progress" role="progressbar" style="width: 500px; margin-left:250px; margin-top:10px" tabindex="0" aria-valuenow="50" aria-valuemin="0" aria-valuetext="50 percent" aria-valuemax="100">
              <div class="progress-meter" id="myBar" style="width: 0%"></div>
          </div>

    <table>
        <tr>
            <td id="backy" style="background-image: url('/assets/background2.png');" >
         
                <div>
                    <canvas id="canJigsaw" width="950" height="350" style="border: black solid 2px;">
            
                    </canvas>
                       </div>


                   <img id="balala" width="0" height="0" style="position: absolute; top: 100px; left: 123px;"></img> 
                   
                      <img id="imgprev1" width="0" height="0" style="position: absolute; top: 100px; left: 123px;"></img> 
                         
                        <img id="img0" width="130" height="130" style="position: absolute; top: 470px; left: 225px;"></img>

                      <img id="img1" width="80" height="80" src="/assets/puzzle/l1/1.jpg"  style="position: absolute; top: 495px; left: 474px;"></img>

                        <img id="img2" width="80" height="80" src="/assets/puzzle/l1/2.jpg"  style="position: absolute; top: 495px; left: 571px;"></img>

                     <img id="img3" width="80" height="80" src="/assets/puzzle/l1/3.jpg"  style="position: absolute; top: 495px; left: 673px;"></img>



                     <img width="150" height="150"src="/assets/puzzle/frame.png" style="position: absolute; top: 460px; left: 215px;"></img>

                          <a><i style="position: absolute; top: 500px; left: 400px; font-size: 4.3em;color: #ff6600;" class="icon-right-open"></i><i style="position: absolute; top: 500px; left: 370px; font-size: 4.3em; color: #ff6600;" class="icon-right-open" ></i></a>


                     <img width="90" height="90"src="/assets/puzzle/frame.png" style="position: absolute; top: 490px; left: 470px;" onclick="LoadNewImage2('img1'); listen('1'); ShowPreview(2);  "></img>
                     <img width="90" height="90"src="/assets/puzzle/frame.png" style="position: absolute; top: 490px; left: 567px;" onclick="LoadNewImage2('img2'); listen('2'); ShowPreview(2); "></img>
                     
                     <img width="90" height="90"src="/assets/puzzle/frame.png" style="position: absolute; top: 490px; left: 667px;" onclick="LoadNewImage2('img3'); listen('3');  ShowPreview(2); "></img>


    </table>
                    
         <a  href='#' class="btnBlue" id="level1">1</a>
    <a  href='#' class="btnGreen" id="level2">2</a>
    <a  href='#' class="btnYellow" id="level3">3</a>
    <a  href='#' class="btnOrange" id="level4">4</a>
    <a  href='#' class="btnRed" id="level5">5</a>
     <a><i style="right: 45px; position: relative; top: 350px;  color: #FF7519; " class="icon-star-filled" onclick="ShowPreview(1)" id="peekz"></i></a>

   </div>




    <div class="footer" id="footy">
      <div class="row" data-equalizer>
        <div class="large-3 columns footer-section" data-equalizer-watch>
          <h1>GWAP</h1>
        </div>
        <div class="large-3 columns footer-section" data-equalizer-watch>
          <div class="row">
            <div class="large-12 columns" >
              <h6>Lorem Ipsum</h6>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            </div>
          </div>

          <div class="row border-top">
            <div class="large-12 columns" >
              <h6>Jailan Salah<p><b>Researcher</b></p></h6>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            </div>
          </div>
          
        </div>
        <div class="large-3 columns footer-section" data-equalizer-watch>
          <div class="row">
            <div class="large-12 columns" >
              <h6>Lorem Ipsum</h6>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            </div>
          </div>

          <div class="row border-top">
            <div class="large-12 columns" >
              <h6>Contact Us</h6>
              <p>German University in Cairo</br>
                New Cairo City . Main Entrance El-Tagamoa El-Khames</p>
              <p>Hotline 16482 . Tel: +202 27589990-8 . Fax: +202 27581041</p>
            </div>
          </div>
        </div>
        <div class="large-3 columns footer-section-last" data-equalizer-watch>
          <div class="row">
            <div class="large-12 columns" >
              <h6>Other Projects</h6>
              <ul>
                <li>
                  <a>Kodr</a>
                </li>
                <li>
                  <a>Rules of Wheels</a>
                </li>
                <li>
                  <a>Lydia</a>
                </li>
              </ul>
            </div>
          </div>

          <div class="row border-top">
            <div class="large-12 columns" >
              <h6>Lorem Ipsum</h6>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            </div>
          </div>
        </div>
      </div>
    </div>




       <aside id="hamada" width="1200" height="500">
      <img src="/assets/fire/big-glow.png" id="big-glow" />
      <img src="/assets/fire/small-glow.png" id="small-glow" />
    </aside>


      <script src="/assets/fire/fireworks.js"></script>
</body>
</html>




